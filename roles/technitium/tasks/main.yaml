- name: Gathering facts
  ansible.builtin.setup:

- name: Pull technitium image
  community.docker.docker_image:
    name: technitium/dns-server:{{technitium_image_tag}}
    source: pull

- name: Disable systemd-resolved
  ansible.builtin.systemd_service:
    state: stopped
    daemon_reload: true
    enabled: false
    name: systemd-resolved

- name: Add local server as DNS
  ansible.builtin.lineinfile:
    path: "/etc/resolv.conf"
    line: 'nameserver 127.0.0.1'

- name: Create systemd config file
  ansible.builtin.template:
    src: templates/technitium.service.j2
    dest: /etc/systemd/system/technitium.service
    mode: '0700'

- name: Enable and start service
  ansible.builtin.systemd_service:
    state: started
    daemon_reload: true
    enabled: true
    name: technitium.service