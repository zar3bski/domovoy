[Unit]
Description=Grafana
Requires=docker.service

[Service]
TimeoutStartSec=0
RestartSec=10
Restart=always
ExecStartPre=/usr/bin/docker info
ExecStartPre=/usr/bin/docker pull grafana/grafana:{{prometheus_grafana_image_tag}}
ExecStart=/usr/bin/docker run --rm --name %n \
    --network=observability \
    --user 1002 \
    -v /home/grafana/provisioning:/etc/grafana/provisioning \
    -v /home/grafana/data:/var/lib/grafana \
    -e GF_SECURITY_ADMIN_USER=admin \
    -e GF_SECURITY_ADMIN_PASSWORD={{grafana_admin}} \
    -e GF_SERVER_DOMAIN=grafana.{{inventory_hostname}} \
    -p 3000:3000 \
    grafana/grafana:{{prometheus_grafana_image_tag}}
ExecStop=/usr/bin/docker stop %n
ExecStop=/usr/bin/docker rm %n
[Install]
WantedBy=default.target
